<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMPOSTOR By:Payd</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: radial-gradient(circle at top right, #1e1b4b, #0f172a);
        }

        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .neo-button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .neo-button:active {
            transform: scale(0.95);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 5px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 10px;
        }
    </style>
</head>

<body class="text-slate-200 min-h-screen pb-10">

    <div class="container mx-auto max-w-md px-4 pt-8">
        <div class="text-center mb-8">
            <h1
                class="text-5xl font-extrabold tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500 italic">
                IMPOSTOR
            </h1>
            <p class="text-slate-400 text-sm mt-2 tracking-widest uppercase">Secret Word Game</p>
        </div>

        <div id="setup-ui" class="space-y-6">
            <div class="glass rounded-3xl p-6 shadow-2xl">
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="space-y-2">
                        <label
                            class="text-[10px] font-bold text-cyan-400 uppercase tracking-wider ml-1">Impostor</label>
                        <input type="number" id="impostor-count" value="1" min="1" onchange="saveSettings()"
                            class="w-full bg-slate-900/50 border border-slate-700 rounded-2xl py-3 px-4 focus:ring-2 focus:ring-cyan-500 outline-none transition-all">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-bold text-cyan-400 uppercase tracking-wider ml-1">Max
                            Vote</label>
                        <input type="number" id="max-vote-count" value="3" min="1" onchange="saveSettings()"
                            class="w-full bg-slate-900/50 border border-slate-700 rounded-2xl py-3 px-4 focus:ring-2 focus:ring-cyan-500 outline-none transition-all">
                    </div>
                </div>

                <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider ml-1 mb-2 block">Daftar
                    Pemain</label>
                <div id="player-inputs-container" class="space-y-3 mb-6 max-h-60 overflow-y-auto pr-2">
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <button onclick="addPlayerField()"
                        class="neo-button bg-slate-800 hover:bg-slate-700 py-3 rounded-2xl font-bold text-sm">
                        <i class="fas fa-plus mr-2 text-cyan-400"></i>Pemain
                    </button>
                    <button onclick="clearSavedPlayers()"
                        class="neo-button bg-rose-500/10 hover:bg-rose-500/20 text-rose-500 py-3 rounded-2xl font-bold text-sm">
                        <i class="fas fa-undo mr-2"></i>Reset
                    </button>
                </div>
            </div>

            <button onclick="startGameSetup()"
                class="neo-button w-full bg-gradient-to-r from-cyan-500 to-blue-600 py-5 rounded-3xl font-black text-lg shadow-lg shadow-cyan-500/20 uppercase tracking-tighter italic">
                Mulai Persiapan <i class="fas fa-chevron-right ml-2"></i>
            </button>
        </div>

        <div id="game-ui" class="hidden space-y-6">
            <div id="game-status"
                class="glass border-l-4 border-cyan-500 p-5 rounded-2xl text-center text-sm font-semibold leading-relaxed">
            </div>

            <div id="cards-container" class="grid grid-cols-2 gap-4">
            </div>

            <div class="pt-4">
                <button id="btn-action" onclick="handleMainAction()" disabled
                    class="neo-button w-full bg-white text-slate-900 py-5 rounded-3xl font-black text-lg shadow-xl uppercase tracking-tighter disabled:opacity-20 disabled:grayscale transition-all italic">
                    Mulai Game
                </button>
            </div>
        </div>
    </div>

    <div id="word-modal"
        class="modal fixed inset-0 z-[2000] hidden items-center justify-center p-6 bg-slate-950/95 backdrop-blur-xl">
        <div class="text-center space-y-8 w-full">
            <div class="space-y-2">
                <h2 id="modal-player-name" class="text-3xl font-black text-cyan-400 italic"></h2>
                <p class="text-slate-500 font-medium">Jangan sampai orang lain melihat!</p>
            </div>

            <div class="py-12 px-4 glass rounded-[40px] border-cyan-500/30">
                <p class="text-[10px] text-cyan-500 uppercase tracking-[0.3em] mb-4 font-bold">Kata Rahasia Kamu</p>
                <div id="display-word" class="text-5xl font-black tracking-tighter text-white uppercase italic"></div>
            </div>

            <button onclick="closeModal()"
                class="neo-button w-full bg-cyan-500 py-5 rounded-3xl font-black text-slate-900 text-lg shadow-lg shadow-cyan-500/30">
                SAYA SUDAH LIHAT
            </button>
        </div>
    </div>

    <script>

        const wordsPool = [
            { a: "Sendok", b: "Garpu" }, { a: "Piring", b: "Mangkok" }, { a: "Kasur", b: "Tikar" },
            { a: "Bantal", b: "Guling" }, { a: "Sapu", b: "Pel" }, { a: "Ember", b: "Gayung" },
            { a: "Kulkas", b: "Lemari" }, { a: "Kompor", b: "Oven" }, { a: "Cermin", b: "Foto" },
            { a: "Pintu", b: "Jendela" }, { a: "Sikat Gigi", b: "Pasta Gigi" }, { a: "Sabun", b: "Sampo" },
            { a: "Handuk", b: "Selimut" }, { a: "Payung", b: "Jas Hujan" }, { a: "Lampu", b: "Senter" },
            { a: "Kucing", b: "Harimau" }, { a: "Anjing", b: "Serigala" }, { a: "Ayam", b: "Bebek" },
            { a: "Sapi", b: "Kambing" }, { a: "Kuda", b: "Zebra" }, { a: "Gajah", b: "Badak" },
            { a: "Singa", b: "Macan" }, { a: "Ular", b: "Cacing" }, { a: "Ikan", b: "Cumi-cumi" },
            { a: "Kupu-kupu", b: "Lebah" }, { a: "Semut", b: "Rayap" }, { a: "Burung", b: "Kelelawar" },
            { a: "Kelinci", b: "Marmut" }, { a: "Buaya", b: "Kadal" }, { a: "Monyet", b: "Gorila" },
            { a: "Susu", b: "Santan" }, { a: "Kopi", b: "Teh" }, { a: "Jeruk", b: "Lemon" },
            { a: "Apel", b: "Pir" }, { a: "Nasi", b: "Bubur" }, { a: "Roti", b: "Biskuit" },
            { a: "Bakso", b: "Mie Ayam" }, { a: "Sate", b: "Gulai" }, { a: "Cokelat", b: "Permen" },
            { a: "Garam", b: "Gula" }, { a: "Kecap", b: "Saus" }, { a: "Pizza", b: "Burger" },
            { a: "Semangka", b: "Melon" }, { a: "Pisang", b: "Pepaya" }, { a: "Es Krim", b: "Yogurt" },
            { a: "Mobil", b: "Motor" }, { a: "Sepeda", b: "Skuter" }, { a: "Bus", b: "Kereta" },
            { a: "Pesawat", b: "Helikopter" }, { a: "Kapal", b: "Perahu" }, { a: "HP", b: "Tablet" },
            { a: "Laptop", b: "Komputer" }, { a: "Mouse", b: "Keyboard" }, { a: "YouTube", b: "TikTok" },
            { a: "WhatsApp", b: "Telegram" }, { a: "Instagram", b: "Facebook" }, { a: "Google", b: "Yahoo" },
            { a: "Televisi", b: "Bioskop" }, { a: "Kamera", b: "CCTV" }, { a: "Baterai", b: "Kabel" },
            { a: "Hujan", b: "Badai" }, { a: "Matahari", b: "Bulan" }, { a: "Bintang", b: "Planet" },
            { a: "Gunung", b: "Bukit" }, { a: "Laut", b: "Danau" }, { a: "Sungai", b: "Parit" },
            { a: "Hutan", b: "Taman" }, { a: "Pasir", b: "Tanah" }, { a: "Batu", b: "Bata" },
            { a: "Pelangi", b: "Awan" }, { a: "Api", b: "Asap" }, { a: "Angin", b: "Udara" },
            { a: "Buku", b: "Kertas" }, { a: "Pensil", b: "Pulpen" }, { a: "Tas", b: "Dompet" },
            { a: "Guru", b: "Dosen" }, { a: "Murid", b: "Mahasiswa" }, { a: "Meja", b: "Kursi" },
            { a: "Kantor", b: "Sekolah" }, { a: "Uang", b: "Kartu ATM" }, { a: "Surat", b: "Email" },
            { a: "Peta", b: "Kompas" }, { a: "Kapur", b: "Spidol" }, { a: "Penggaris", b: "Jangka" },
            { a: "Baju", b: "Jaket" }, { a: "Celana", b: "Rok" }, { a: "Sepatu", b: "Sandal" },
            { a: "Topi", b: "Helm" }, { a: "Kaos Kaki", b: "Sarung Tangan" }, { a: "Kacamata", b: "Lensa Kontak" },
            { a: "Jam Tangan", b: "Alarm" }, { a: "Cincin", b: "Kalung" }, { a: "Sisir", b: "Jepit Rambut" },
            { a: "Dokter", b: "Perawat" }, { a: "Polisi", b: "Tentara" }, { a: "Pilot", b: "Masinis" },
            { a: "Pasar", b: "Mall" }, { a: "Rumah Sakit", b: "Apotek" }, { a: "Hotel", b: "Villa" },
            { a: "Sepak Bola", b: "Futsal" }, { a: "Basket", b: "Voli" }, { a: "Lari", b: "Jalan Santai" },
            { a: "Penyanyi", b: "Penari" }, { a: "Pelukis", b: "Pemahat" }, { a: "Penulis", b: "Penyair" }, { a: "Fotografer", b: "Videografer" },
            { a: "Gitar", b: "Ukulele" }, { a: "Piano", b: "Keyboard" }, { a: "Biola", b: "Cello" },
            { a: "Lukisan", b: "Sketsa" }, { a: "Novel", b: "Komik" }, { a: "Film", b: "Serial" },
            { a: "Catur", b: "Damon" }, { a: "Video Game", b: "Board Game" }, { a: "Koran", b: "Majalah" },
            { a: "Radio", b: "Podcast" }, { a: "Piknik", b: "Camping" }, { a: "Pesta", b: "Syukuran" },
            { a: "Mentega", b: "Margarin" }, { a: "Madu", b: "Sirup" }, { a: "Tepung", b: "Tapioka" },
            { a: "Bawang Merah", b: "Bawang Putih" }, { a: "Cabai", b: "Merica" }, { a: "Jahe", b: "Kunyit" },
            { a: "Tempe", b: "Tahu" }, { a: "Sosis", b: "Nugget" }, { a: "Kacang Tanah", b: "Kacang Mete" },
            { a: "Donat", b: "Bakpao" }, { a: "Martabak", b: "Terang Bulan" }, { a: "Sushi", b: "Kebab" },
            { a: "Pepsi", b: "Coca Cola" }, { a: "Krupuk", b: "Emping" }, { a: "Soto", b: "Rawon" },
            { a: "Dapur", b: "Toilet" }, { a: "Gudang", b: "Garasi" }, { a: "Balkon", b: "Teras" },
            { a: "Atap", b: "Plafon" }, { a: "Lantai", b: "Dinding" }, { a: "Bandara", b: "Stasiun" },
            { a: "Pelabuhan", b: "Terminal" }, { a: "Masjid", b: "Mushola" }, { a: "Gereja", b: "Katedral" },
            { a: "Bioskop", b: "Teater" }, { a: "Museum", b: "Galeri" }, { a: "Penjara", b: "Kantor Polisi" },
            { a: "Sawah", b: "Kebun" }, { a: "Pantai", b: "Pulau" }, { a: "Gua", b: "Lembah" },
            { a: "Arsitek", b: "Kontraktor" }, { a: "Koki", b: "Pelayan" }, { a: "Petani", b: "Nelayan" },
            { a: "Satpam", b: "Bodyguard" }, { a: "Pengacara", b: "Jaksa" }, { a: "Hakim", b: "Saksi" },
            { a: "Presiden", b: "Raja" }, { a: "Prajurit", b: "Panglima" }, { a: "Astronot", b: "Pilot" },
            { a: "Sopir", b: "Kondektur" }, { a: "Penjahit", b: "Desainer" }, { a: "Tukang", b: "Kuli" },
            { a: "Tangan", b: "Kaki" }, { a: "Mata", b: "Telinga" }, { a: "Hidung", b: "Mulut" },
            { a: "Jantung", b: "Paru-paru" }, { a: "Otak", b: "Saraf" }, { a: "Luka", b: "Memar" },
            { a: "Batuk", b: "Bersin" }, { a: "Demam", b: "Pusing" }, { a: "Vitamin", b: "Obat" },
            { a: "Puskesmas", b: "Klinik" }, { a: "Ambulans", b: "Mobil Jenazah" },
            { a: "Headset", b: "Speaker" }, { a: "Flashdisk", b: "Harddisk" }, { a: "Printer", b: "Scanner" },
            { a: "Wifi", b: "Bluetooth" }, { a: "Password", b: "Username" }, { a: "Website", b: "Aplikasi" },
            { a: "Download", b: "Upload" }, { a: "Kipas Angin", b: "AC" }, { a: "Mesin Cuci", b: "Setrika" },
            { a: "Bedak", b: "Foundation" }, { a: "Lipstik", b: "Lipgloss" }, { a: "Parfum", b: "Deodoran" },
            { a: "Masker", b: "Lulur" }, { a: "Cermin", b: "Sisir" }, { a: "Gunting", b: "Pisau Cukur" },
            { a: "Berenang", b: "Menyelam" }, { a: "Tinju", b: "Karate" }, { a: "Yoga", b: "Senam" },
            { a: "Panahan", b: "Menembak" }, { a: "Golf", b: "Biliar" }, { a: "Tenis", b: "Badminton" },
            { a: "Surfing", b: "Skating" }, { a: "Maraton", b: "Sprint" },
            { a: "Senang", b: "Bahagia" }, { a: "Sedih", b: "Kecewa" }, { a: "Marah", b: "Kesal" },
            { a: "Berani", b: "Nekat" }, { a: "Pintar", b: "Cerdas" }, { a: "Kaya", b: "Mewah" },
            { a: "Cepat", b: "Kilat" }, { a: "Panas", b: "Hangat" }, { a: "Dingin", b: "Beku" }
        ];

        let players = [];
        let civilWord = "";
        let impostorWord = "";
        let gameState = "setup";
        let currentVoteAttempt = 0;
        let maxVotes = 3;
        let pickedCount = 0;

        window.onload = () => {
            loadSavedPlayers();
            loadSavedSettings();
        };
        // Memuat angka Impostor dan Max Vote dari localStorage
        function loadSavedSettings() {
            const savedImp = localStorage.getItem('impostor_count');
            const savedVote = localStorage.getItem('max_vote_count');

            if (savedImp) document.getElementById('impostor-count').value = savedImp;
            if (savedVote) document.getElementById('max-vote-count').value = savedVote;
        }

        // Menyimpan angka saat input berubah (tambahkan onchange pada HTML)
        function saveSettings() {
            const impCount = document.getElementById('impostor-count').value;
            const voteCount = document.getElementById('max-vote-count').value;
            localStorage.setItem('impostor_count', impCount);
            localStorage.setItem('max_vote_count', voteCount);
        }

        function loadSavedPlayers() {
            let saved = [];
            try {
                saved = JSON.parse(localStorage.getItem('impostor_players')) || [];
            } catch (e) {
                saved = [];
            }

            // Default kalau belum ada data / data kosong
            if (!Array.isArray(saved) || saved.length === 0) {
                saved = ["Player 1", "Player 2", "Player 3"];
            }

            // Biar minimal selalu ada 3 input terlihat
            while (saved.length < 3) saved.push("");

            const container = document.getElementById('player-inputs-container');
            container.innerHTML = "";
            saved.forEach(name => addPlayerField(name));
        }


        function addPlayerField(name = "") {
            const container = document.getElementById('player-inputs-container');

            const wrapper = document.createElement('div');
            wrapper.className = "relative group player-field";

            // Input
            const input = document.createElement('input');
            input.type = "text";
            input.className =
                "player-input w-full bg-slate-900/30 border border-slate-700/50 rounded-xl py-3 pl-4 pr-12 " +
                "focus:border-cyan-500 outline-none transition-all placeholder:text-slate-600";
            input.placeholder = "Nama Pemain";
            input.value = name;

            // Simpan nama saat berubah
            input.addEventListener('change', saveCurrentNames);

            // Tombol hapus (trash)
            const delBtn = document.createElement('button');
            delBtn.type = "button";
            delBtn.className =
                "absolute right-3 top-1/2 -translate-y-1/2 h-9 w-9 rounded-xl " +
                "bg-rose-500/10 hover:bg-rose-500/20 text-rose-400 hover:text-rose-300 " +
                "transition-all active:scale-95";
            delBtn.innerHTML = `<i class="fas fa-trash"></i>`;

            delBtn.addEventListener('click', () => {
                Swal.fire({
                    title: 'Hapus pemain ini?',
                    text: 'Nama pemain akan dihapus dari daftar.',
                    icon: 'warning',
                    background: '#0f172a',
                    color: '#f1f5f9',
                    showCancelButton: true,
                    confirmButtonColor: '#f43f5e',
                    cancelButtonColor: '#334155',
                    confirmButtonText: 'Hapus',
                    cancelButtonText: 'Batal'
                }).then((result) => {
                    if (result.isConfirmed) {
                        wrapper.remove();
                        saveCurrentNames();
                    }
                });
            });


            wrapper.appendChild(input);
            wrapper.appendChild(delBtn);
            container.appendChild(wrapper);
        }


        function saveCurrentNames() {
            const inputs = document.querySelectorAll('.player-input');
            const names = Array.from(inputs).map(i => i.value.trim()).filter(n => n !== "");
            localStorage.setItem('impostor_players', JSON.stringify(names));
        }

        function clearSavedPlayers() {
            if (confirm("Hapus semua data pemain dan pengaturan?")) {
                localStorage.removeItem('impostor_players');
                localStorage.removeItem('impostor_count');
                localStorage.removeItem('max_vote_count');
                location.reload(); // Reload agar input kembali ke default HTML
            }
        }

        function startGameSetup() {
            saveCurrentNames();
            const inputs = document.querySelectorAll('.player-input');
            players = [];
            inputs.forEach(inp => {
                if (inp.value.trim() !== "") {
                    players.push({ name: inp.value, role: "civil", isOut: false, hasPicked: false });
                }
            });

            if (players.length < 3) { alert("Minimal 3 pemain dibutuhkan!"); return; }

            let roleMemory = JSON.parse(localStorage.getItem('role_memory')) || {};
            const setIdx = Math.floor(Math.random() * wordsPool.length);
            const selectedSet = wordsPool[setIdx];
            const setKey = `${selectedSet.a}-${selectedSet.b}`;

            if (roleMemory[setKey] === undefined) {
                const flip = Math.random() > 0.5;
                civilWord = flip ? selectedSet.a : selectedSet.b;
                impostorWord = flip ? selectedSet.b : selectedSet.a;
            } else {
                impostorWord = roleMemory[setKey];
                civilWord = (impostorWord === selectedSet.a) ? selectedSet.b : selectedSet.a;
                const temp = impostorWord;
                impostorWord = civilWord;
                civilWord = temp;
            }

            roleMemory[setKey] = impostorWord;
            if (Object.keys(roleMemory).length >= wordsPool.length) {
                localStorage.removeItem('role_memory');
            } else {
                localStorage.setItem('role_memory', JSON.stringify(roleMemory));
            }

            // Tambahkan ini di dalam startGameSetup, setelah pengecekan players.length < 3
            const impCount = parseInt(document.getElementById('impostor-count').value);
            if (impCount >= players.length - 1) {
                alert("Terlalu banyak Impostor! Sisakan minimal 2 warga sipil.");
                return;
            }
            maxVotes = parseInt(document.getElementById('max-vote-count').value);
            let assigned = 0;
            while (assigned < impCount) {
                let idx = Math.floor(Math.random() * players.length);
                if (players[idx].role !== "impostor") {
                    players[idx].role = "impostor";
                    assigned++;
                }
            }

            players.forEach(p => p.word = (p.role === "civil" ? civilWord : impostorWord));

            document.getElementById('setup-ui').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            document.getElementById('game-status').innerHTML = `<i class="fas fa-hand-holding-mobile mr-2 text-cyan-400"></i> Berikan HP ke pemain untuk memilih kartu!`;
            gameState = "pick";
            renderCards();
        }

        function renderCards() {
            const container = document.getElementById('cards-container');
            container.innerHTML = "";
            players.forEach((p, index) => {
                const card = document.createElement('div');
                let cardClasses = "player-card neo-button glass p-5 rounded-[2rem] border-2 transition-all text-center ";

                if (p.isOut) {
                    cardClasses += "opacity-20 border-transparent grayscale";
                } else if (p.hasPicked) {
                    cardClasses += "border-cyan-500/50 bg-cyan-500/10";
                } else {
                    cardClasses += "border-white/10 hover:border-white/30";
                }

                if (gameState === 'vote' && !p.isOut) cardClasses += " border-rose-500/50 animate-pulse";

                card.className = cardClasses;
                card.innerHTML = `
                <div class="text-[10px] font-bold uppercase tracking-widest text-slate-500 mb-1">Pemain</div>
                <div class="font-black text-lg truncate">${p.name}</div>
                <div class="mt-2 text-[10px] uppercase font-bold ${p.hasPicked ? 'text-cyan-400' : 'text-slate-600'}">
                    ${p.isOut ? 'Eliminasi' : (p.hasPicked ? 'Sudah Intip' : 'Belum Intip')}
                </div>
            `;
                card.onclick = () => handleCardClick(index);
                container.appendChild(card);
            });
        }

        function handleCardClick(index) {
            if (gameState === "pick" && !players[index].hasPicked) {
                document.getElementById('modal-player-name').innerText = players[index].name;
                document.getElementById('display-word').innerText = players[index].word;
                document.getElementById('word-modal').classList.remove('hidden');
                document.getElementById('word-modal').classList.add('flex');
                players[index].hasPicked = true;
                pickedCount++;
                renderCards();
                if (pickedCount === players.length) document.getElementById('btn-action').disabled = false;
            } else if (gameState === "vote" && !players[index].isOut) {
                processVote(index);
            }
        }

        function closeModal() {
            document.getElementById('word-modal').classList.add('hidden');
            document.getElementById('word-modal').classList.remove('flex');
        }

        function handleMainAction() {
            if (gameState === "pick") {
                gameState = "play";
                // LOGIKA RANDOM STARTER
                const starter = players[Math.floor(Math.random() * players.length)].name;
                document.getElementById('game-status').innerHTML = `
                <div class="text-cyan-400 mb-1 font-black uppercase tracking-tighter italic">Diskusi Dimulai!</div>
                Pemain Pertama: <span class="text-white font-black uppercase">${starter}</span>
            `;
                document.getElementById('btn-action').innerText = "Buka Vote";
                document.getElementById('btn-action').classList.replace('bg-white', 'bg-rose-500');
                document.getElementById('btn-action').classList.add('text-white');
            } else {
                gameState = "vote";
                document.getElementById('game-status').innerHTML = `
                <div class="text-rose-500 mb-1 font-black uppercase italic">Sesi Voting!</div>
                Sisa Kesempatan: <span class="text-white font-black">${maxVotes - currentVoteAttempt}</span>
            `;
                document.getElementById('btn-action').classList.add('hidden');
                renderCards();
            }
        }

        function processVote(index) {
            currentVoteAttempt++;
            const isImp = players[index].role === "impostor";
            players[index].isOut = true;

            // Hitung sisa impostor yang masih aktif
            const remainingImpostors = players.filter(p => p.role === "impostor" && !p.isOut).length;
            const remainingVotes = maxVotes - currentVoteAttempt;

            if (isImp) {
                if (remainingImpostors === 0) {
                    // SEMUA IMPOSTOR TERTANGKAP
                    Swal.fire({
                        title: 'ðŸŽ‰ CIVIL MENANG!',
                        html: `Impostor terakhir <b class="text-cyan-500">${players[index].name}</b> telah tertangkap! <br>Warga berhasil mengamankan wilayah.`,
                        icon: 'success',
                        background: '#0f172a',
                        color: '#f1f5f9',
                        confirmButtonColor: '#06b6d4',
                        confirmButtonText: 'Main Lagi'
                    }).then(() => location.reload());
                } else if (remainingVotes < remainingImpostors) {
                    // IMPOSTOR MASIH ADA TAPI VOTE TIDAK CUKUP UNTUK MENANG
                    gameOverImpostorWin(`Warga menyerah! Sisa vote (${remainingVotes}) tidak cukup untuk menangkap ${remainingImpostors} Impostor.`);
                } else {
                    // BERHASIL TAPI MASIH ADA SISA
                    Swal.fire({
                        title: 'ðŸ”¥ BERHASIL!',
                        html: `<b class="text-rose-500">${players[index].name}</b> tereliminasi! <br>Tapi hati-hati, masih ada <b class="text-yellow-500">${remainingImpostors}</b> Impostor lagi!`,
                        icon: 'info',
                        background: '#0f172a',
                        color: '#f1f5f9',
                        confirmButtonColor: '#06b6d4',
                        confirmButtonText: 'Lanjut Cari Sisa Impostor'
                    }).then(() => continuePlaying());
                }
            } else {
                // SALAH VOTE (Warga Tereliminasi)
                if (remainingVotes < remainingImpostors || remainingVotes <= 0) {
                    gameOverImpostorWin(remainingVotes <= 0 ? "Kesempatan vote habis!" : "Sisa vote tidak cukup untuk menangkap sisa Impostor.");
                } else {
                    Swal.fire({
                        title: 'âŒ SALAH VOTE!',
                        html: `<b class="text-white">${players[index].name}</b> ternyata hanya warga sipil biasa.<br>Asal tuduh njirr!`,
                        icon: 'warning',
                        background: '#1e1b4b',
                        color: '#f1f5f9',
                        confirmButtonColor: '#6366f1',
                        confirmButtonText: 'Lanjutkan Diskusi'
                    }).then(() => continuePlaying());
                }
            }
        }

        // Fungsi baru untuk menangani kekalahan Civil agar kode tidak duplikat
        function gameOverImpostorWin(reason) {
            Swal.fire({
                title: 'ðŸ’€ IMPOSTOR MENANG!',
                html: `${reason}<br><br>
                   <div class="p-4 glass rounded-2xl text-left space-y-2">
                       <p class="text-sm">Kata Civil: <b class="text-cyan-400">${civilWord}</b></p>
                       <p class="text-sm">Kata Impostor: <b class="text-rose-500">${impostorWord}</b></p>
                   </div>`,
                icon: 'error',
                background: '#0f172a',
                color: '#f1f5f9',
                confirmButtonColor: '#f43f5e',
                confirmButtonText: 'Yah, Kalah...'
            }).then(() => location.reload());
        }

        // Fungsi pembantu agar kode lebih rapi
        function continuePlaying() {
            gameState = "play";
            document.getElementById('game-status').innerHTML = `
            <div class="text-rose-500 mb-1 font-black uppercase italic">Permainan Berlanjut!</div>
            Sisa Kesempatan Vote: <span class="text-white font-black">${maxVotes - currentVoteAttempt}</span>
        `;
            document.getElementById('btn-action').classList.remove('hidden');
            document.getElementById('btn-action').innerText = "Lanjut Vote";
            renderCards();
        }
    </script>

</body>

</html>